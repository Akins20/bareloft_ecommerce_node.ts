<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bareloft Products Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        #status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .loading {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        #products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .product-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .product-card h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        .product-card p {
            margin: 5px 0;
            color: #666;
        }
        .price {
            font-size: 1.2em;
            color: #27ae60;
            font-weight: bold;
        }
        .stock {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            margin-top: 10px;
        }
        .in-stock {
            background-color: #d4edda;
            color: #155724;
        }
        .out-of-stock {
            background-color: #f8d7da;
            color: #721c24;
        }
        #timing {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
        button {
            display: block;
            margin: 20px auto;
            padding: 12px 24px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <h1>üõçÔ∏è Bareloft E-commerce - Products Test</h1>

    <div id="status" class="loading">Loading products...</div>
    <div id="timing"></div>

    <button onclick="fetchProducts()">Reload Products</button>

    <div id="products"></div>

    <script>
        const API_URL = 'http://localhost:3007/api/v1/products';

        async function fetchProducts() {
            const statusEl = document.getElementById('status');
            const productsEl = document.getElementById('products');
            const timingEl = document.getElementById('timing');

            // Reset UI
            statusEl.className = 'loading';
            statusEl.textContent = 'Loading products...';
            productsEl.innerHTML = '';
            timingEl.innerHTML = '';

            const startTime = performance.now();

            try {
                console.log('Fetching from:', API_URL);

                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);

                console.log('Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Response data:', data);

                // Display timing
                timingEl.innerHTML = `
                    <strong>‚ö° Response Time: ${duration}ms</strong><br>
                    <small>Status: ${response.status} | Products: ${data.data?.products?.length || 0}</small>
                `;

                // Display success
                statusEl.className = 'success';
                statusEl.textContent = `‚úÖ Successfully loaded ${data.data?.products?.length || 0} products in ${duration}ms`;

                // Display products
                if (data.success && data.data?.products) {
                    displayProducts(data.data.products);
                } else {
                    productsEl.innerHTML = '<p>No products found</p>';
                }

            } catch (error) {
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);

                console.error('Fetch error:', error);

                statusEl.className = 'error';
                statusEl.innerHTML = `
                    ‚ùå Error: ${error.message}<br>
                    <small>Time taken: ${duration}ms</small>
                `;

                productsEl.innerHTML = `
                    <div style="padding: 20px; background: #f8d7da; border-radius: 8px;">
                        <h3>Error Details:</h3>
                        <pre>${error.stack || error.message}</pre>
                    </div>
                `;
            }
        }

        function displayProducts(products) {
            const productsEl = document.getElementById('products');

            productsEl.innerHTML = products.map(product => `
                <div class="product-card">
                    <h3>${product.name}</h3>
                    <p>${product.description || 'No description available'}</p>
                    <p class="price">‚Ç¶${parseInt(product.price).toLocaleString()}</p>
                    <p><strong>Category:</strong> ${product.category?.name || 'N/A'}</p>
                    <p><strong>SKU:</strong> ${product.sku || 'N/A'}</p>
                    <span class="stock ${product.inStock ? 'in-stock' : 'out-of-stock'}">
                        ${product.inStock ? `In Stock (${product.stockQuantity})` : 'Out of Stock'}
                    </span>
                </div>
            `).join('');
        }

        // Auto-fetch on page load
        window.addEventListener('DOMContentLoaded', fetchProducts);
    </script>
</body>
</html>
